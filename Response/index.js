const products = [
    {
        id: 0,
        name: 'Crab ddd Security',
        price: '₹ 400.00',
        image: 'img/Nissy/Newimages/2.jpg',
        backimage: 'img/Nissy/Newimages/9.jpg',
        category: 'naturalprotienpowder',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/1.jpg', 'img/Nissy/Newimages/2.jpg', 'img/Nissy/Newimages/5.jpg'],
        availability: "asas of Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productdescription: "dfssssssssssssssssssssssssssssssssss",
        information: "fffffffffffffffffffffffffffffffffffffff",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    {
        id: 1,
        name: 'Crab Pool Security',
        price: '₹ 400.00',
        image: 'img/Nissy/Newimages/2.jpg',
        backimage: 'img/Nissy/Newimages/9.jpg',
        category: 'naturalprotienpowder',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/1.jpg', 'img/Nissy/Newimages/2.jpg', 'img/Nissy/Newimages/5.jpg'],
        availability: "lusu of Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    {
        id: 2,
        name: 'Crab Pool Security',
        price: '₹ 400.00', image: 'img/Nissy/Newimages/2.jpg',
        category: 'naturalprotienpowder',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/1.jpg', 'img/Nissy/Newimages/2.jpg', 'img/Nissy/Newimages/5.jpg'],
        availability: "wsdsa of Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    {
        id: 3,
        name: 'Crab Pool Security',
        price: '₹ 400.00',
        image: 'img/Nissy/Newimages/4.jpg',
        category: 'Malt',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/3.jpg', 'img/Nissy/Newimages/6.jpg'],
        availability: "out od Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    {
        id: 4,
        name: 'Crab Pool Security',
        price: '₹ 400.00', image: 'img/Nissy/Newimages/5.jpg',
        category: 'Malt',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/3.jpg', 'img/Nissy/Newimages/6.jpg'],
        availability: "In of Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    {
        id: 5,
        name: 'Crab Pool Security',
        price: '₹ 400.00', image: 'img/Nissy/Newimages/6.jpg',
        category: 'babyfood',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/3.jpg', 'img/Nissy/Newimages/6.jpg'],
        availability: "In Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    {
        id: 6,
        name: 'Crab Pool Security',
        price: '₹ 400.00', image: 'img/Nissy/Newimages/7.jpg',
        category: 'babyfood',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/3.jpg', 'img/Nissy/Newimages/6.jpg'],
        availability: "In Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    {
        id: 7,
        name: 'skin care',
        price: '₹ 400.00', image: 'img/Nissy/Newimages/8.jpg',
        category: 'skincare',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/3.jpg', 'img/Nissy/Newimages/6.jpg'],
        availability: "Out of Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    {
        id: 8,
        name: 'Crab Pool Security',
        price: '₹ 400.00', image: 'img/Nissy/Newimages/9.jpg',
        category: 'skincare',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/3.jpg', 'img/Nissy/Newimages/6.jpg'],
        availability: "In Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    {
        id: 9,
        name: 'Crab Pool Security',
        price: '$30.00',
        image: 'img/Nissy/Newimages/10.jpg',
        category: 'skincare',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/3.jpg', 'img/Nissy/Newimages/6.jpg'],
        availability: "In Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 1000 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },

    {
        id: 10,
        name: 'Crab Pool Security',
        price: '₹ 400.00',
        image: 'img/Nissy/Newimages/4.jpg',
        category: 'Malt',
        description: 'Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quibusdam odio quidem aliquid voluptatem veritatis maxime eaque voluptatum expedita illo excepturi atque at assumenda quod, delectus ipsa aliquam cupiditate cum tempora.',
        weightOptions: ['1L', '250ml', '500ml'],
        images: ['img/Nissy/Newimages/3.jpg', 'img/Nissy/Newimages/6.jpg'],
        availability: "out od Stock",
        shipping: "01 day shipping. <samp>Free pickup today</samp>",
        weightDetail: "0.5 kg",
        rate: " ₹ 400.00",
        productImage: [
            "img/product/details/product-details-1.jpg",
            "img/product/details/thumb-1.jpg",
            "img/product/details/thumb-2.jpg",
            "img/product/details/thumb-3.jpg",
            "img/product/details/thumb-4.jpg"
        ],
        weights: [
            { id: "weight1", value: "1KG", label: "1KG", price: 200 },
            { id: "weight2", value: "250GM", label: "250GM", price: 100 },
            { id: "weight3", value: "500GM", label: "500GM", price: 101 }
        ],
    },
    // Add more products as needed
];

// function generateProductHTML(product) {
//     const weightOptionsHTML = product.weights.map(weight =>
//         `<label>
//         <input type="radio" name="weight-${product.id}" value="${weight.value}" data-price="${weight.price}" onclick="updatePrice(${product.id})"> 
//         ${weight.label}
//     </label><br>`).join('');
//     const imagesHTML = product.images.map(img =>
//         `<img src="${img}" alt="image">`).join('');

//     return `
//                 <div class="featured__filter-items col-lg-3 col-md-4 col-sm-6 mix ${product.category}">
//                     <div class="featured__item">
//                         <div class="featured__item__pic set-bg" onclick="location.href='shop-details.html?id=${product.id}'" style="background-image: url(${product.image});"> 
//                        </div>
//                         <div class="featured__item__text">
//                             <h6><a href="#">${product.name}</a></h6>
//                             <h5>${product.price}</h5>
//                             <button class="featured__item__text-optionbtn" onclick="openNav(${product.id})">Select Option</button>
//                             <div id="overlay-${product.id}" class="overlay" onclick="closeNav(${product.id})"></div>
//                             <div id="mySidenav-${product.id}" class="sidenav">
//                                 <a href="javascript:void(0)" class="closebtn" onclick="closeNav(${product.id})">&times;</a>
//                                 <div class="sidenav-content">
//                                     <div class="slider" id="slider-${product.id}">
//                                         <div class="slides" id="slides-${product.id}">
//                                             ${imagesHTML}
//                                         </div>
//                                         <button class="prev" onclick="moveSlide(${product.id}, -1)">&#10094;</button>
//                                         <button class="next" onclick="moveSlide(${product.id}, 1)">&#10095;</button>
//                                     </div>
//                                     <div class="main-content">
//                                         <div class="main-content-heading"><a>${product.name}</a></div>
//                                         <p>${product.price}</p>
//                                         <p>${product.description}</p>
//                                         <div>
//                                             <h4>Weight</h4>
//                                             <div class="weight-display">
//                                                 ${weightOptionsHTML}
//                                             </div>
//                                         </div>
//                                         <div id="price-display-${product.id}" class="price-display">
//                                     Price: ₹<span id="calculated-price-${product.id}">0</span>
//                                 </div>
//                                         <div class="order-section">
//                                             <button class="order-section-countbutton" onclick="changeQuantity1(-1, ${product.id})">-</button>
//                                             <span id="quantity-${product.id}">1</span>
//                                             <button class="order-section-countbutton" onclick="changeQuantity1(1, ${product.id})">+</button>
//                                     <button class="add-to-cart" onclick="addToCartWithSelectedWeight(${product.id})">Add to Cart</button>
//                                     <button class="buy-now" onclick="buyNow(${product.id}, '${product.name}', '${product.price}')">Buy Now</button>
//                                         </div>
//                                     </div>
//                                 </div>
//                             </div>
//                         </div>
//                     </div>
//                 </div>`;
// }


function generateProductHTML(product) {
    const weightOptionsHTML = product.weights.map(weight =>
        `<label>
        <input type="radio" name="weight-${product.id}" value="${weight.value}" data-price="${weight.price}" onclick="updatePrice(${product.id})"> 
        ${weight.label}
    </label><br>`).join('');
    const imagesHTML = product.images.map(img =>
        `<img src="${img}" alt="image">`).join('');

    return `
                <div class="featured__filter-items col-lg-3 col-md-4 col-sm-6 mix ${product.category}">
                    <div class="featured__item">
                        <div class="featured__item__pic set-bg" onclick="location.href='shop-details.html?id=${product.id}'" style="background-image: url(${product.image});"> 
                       </div>
                        <div class="featured__item__text">
                            <h6><a href="#">${product.name}</a></h6>
                            <h5>${product.price}</h5>
                            <button class="featured__item__text-optionbtn" onclick="openNav(${product.id})">Select Option</button>
                            <div id="overlay-${product.id}" class="overlay" onclick="closeNav(${product.id})"></div>
                            <div id="mySidenav-${product.id}" class="sidenav">
                                <a href="javascript:void(0)" class="closebtn" onclick="closeNav(${product.id})">&times;</a>
                                <div class="sidenav-content">
                                    <div class="slider" id="slider-${product.id}">
                                        <div class="slides" id="slides-${product.id}">
                                            ${imagesHTML}
                                        </div>
                                        <button class="prev" onclick="moveSlide(${product.id}, -1)">&#10094;</button>
                                        <button class="next" onclick="moveSlide(${product.id}, 1)">&#10095;</button>
                                    </div>
                                    <div class="main-content">
                                        <div class="main-content-heading"><a>${product.name}</a></div>
                                        <p>${product.price}</p>
                                        <p>${product.description}</p>
                                        <div>
                                            <h4>Weight</h4>
                                            <div class="weight-display">
                                                ${weightOptionsHTML}
                                            </div>
                                        </div>
                                        <div id="price-display-${product.id}" class="price-display">
                                    Price: ₹<span id="calculated-price-${product.id}">0</span>
                                </div>
                                        <div class="order-section">
                                            <button class="order-section-countbutton" onclick="changeQuantity1(-1, ${product.id})">-</button>
                                            <span id="quantity-${product.id}">1</span>
                                            <button class="order-section-countbutton" onclick="changeQuantity1(1, ${product.id})">+</button>
                                    <button class="add-to-cart" onclick="addToCartWithSelectedWeight(${product.id})">Add to Cart</button>
                                    <button class="buy-now" onclick="buyNow(${product.id}, '${product.name}', '${product.price}')">Buy Now</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
}


function addToCartWithSelectedWeight(productId) {
    const selectedWeightElement = document.querySelector(`input[name='weight-${productId}']:checked`);
    if (!selectedWeightElement) {
        console.error(`No weight selected for product ID: ${productId}`);
        return;
    }

    const selectedWeight = selectedWeightElement.value;
    const pricePerUnit = parseFloat(selectedWeightElement.getAttribute('data-price'));

    console.log("Quantity:", selectedWeight);

    const quantityElement = document.getElementById(`quantity-${productId}`);
    if (!quantityElement) {
        console.error(`Quantity element with ID quantity-${productId} not found`);
        return;
    }

    const quantity = parseInt(quantityElement.textContent);

    if (isNaN(quantity)) {
        console.error('Invalid quantity value');
        return;
    }

    addToCart(productId, selectedWeight, quantity, pricePerUnit);
}

// function addToCartWithSelectedWeight(productId) {
//     const selectedWeightElement = document.querySelector(`input[name='weight-${productId}']:checked`);
//     if (!selectedWeightElement) {
//         console.error(`No weight selected for product ID: ${productId}`);
//         return;
//     }

//     const selectedWeight = selectedWeightElement.value;
//     const pricePerUnit = parseFloat(selectedWeightElement.getAttribute('data-price'));

//     console.log("Quantity:", selectedWeight);

//     const quantityElement = document.getElementById(`quantity-${productId}`);
//     if (!quantityElement) {
//         console.error(`Quantity element with ID quantity-${productId} not found`);
//         return;
//     }

//     const quantity = parseInt(quantityElement.textContent); 

//     if (isNaN(quantity)) {
//         console.error('Invalid quantity value');
//         return;
//     }

//     addToCart(productId, selectedWeight, quantity, pricePerUnit); 
// }


function buyNow(productId, productName, productPrice) {
    const quantity = document.getElementById(`quantity-${productId}`).innerText;
    const weightOptions = document.getElementsByName(`weight-${productId}`);
    let selectedWeight = null;
    for (let option of weightOptions) {
        if (option.checked) {
            selectedWeight = option.value;
            break;
        }
    }

    if (!selectedWeight) {
        alert('Please select a weight option.');
        return;
    }

    const product = { id: productId, name: productName, price: productPrice, quantity, weight: selectedWeight };
    localStorage.setItem('checkoutProduct', JSON.stringify(product));
    location.href = 'checkout.html';
}


function updatePrice(productId) {
    const selectedWeight = document.querySelector(`input[name='weight-${productId}']:checked`);
    const quantity = parseInt(document.getElementById(`quantity-${productId}`).textContent);
    const priceDisplay = document.getElementById(`calculated-price-${productId}`);

    console.log("Selected weight:", selectedWeight);

    if (selectedWeight && priceDisplay) {
        const pricePerUnit = parseFloat(selectedWeight.getAttribute('data-price'));
        console.log("Price per unit:", pricePerUnit);
        const totalPrice = pricePerUnit * quantity;
        priceDisplay.textContent = totalPrice.toFixed(2);
    }
}

function showToast(message) {
    const toast = document.getElementById('toast');
    const toastMessage = toast.querySelector('.toast-message');

    toastMessage.textContent = message; 
    toast.classList.add('show'); 

    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// function addToCart(productId, selectedWeight, quantity,pricePerUnit) {
    
//     const product = products.find(p => p.id === productId);

//     if (!selectedWeight) {
//         alert('Please select a weight option.');
//         return;
//     }

//     if (isNaN(quantity) || quantity < 1) {
//         alert('Please select a valid quantity.');
//         return;
//     }
//     let cart = JSON.parse(localStorage.getItem('cart')) || [];
//     const updatedprice = quantity * pricePerUnit;
//     const existingProductIndex = cart.findIndex(item => item.id === product.id && item.weight === selectedWeight && item.pricePerUnit == updatedprice);

//     if (existingProductIndex !== -1) {
//         cart[existingProductIndex].quantity += quantity;
//     } else {
//         cart.push({ ...product, weight: selectedWeight, pricePerUnit:updatedprice, quantity: quantity });
//     }

//     localStorage.setItem('cart', JSON.stringify(cart));

//     updateCartCount();
//     closeNav(productId);

//     showToast('Item added to cart!');
// }

function addToCart(productId, selectedWeight, quantity, pricePerUnit) {
    const product = products.find(p => p.id === productId);

    if (!selectedWeight) {
        alert('Please select a weight option.');
        return;
    }

    if (isNaN(quantity) || quantity < 1) {
        alert('Please select a valid quantity.');
        return;
    }

    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    const existingProductIndex = cart.findIndex(item => item.id === product.id && item.weight === selectedWeight);

    if (existingProductIndex !== -1) {
        cart[existingProductIndex].quantity += quantity;
        cart[existingProductIndex].pricePerUnit += quantity * pricePerUnit;
    } else {
        cart.push({ ...product, weight: selectedWeight, pricePerUnit: quantity * pricePerUnit, quantity: quantity });
    }

    localStorage.setItem('cart', JSON.stringify(cart));

    updateCartCount();
    closeNav(productId);

    showToast('Item added to cart!');
}

function renderProducts(products) {
    const container = document.querySelector('.featured__filter');
    container.innerHTML = products.map(generateProductHTML).join('');
}

$(document).ready(function () {
    renderProducts(products);
    updateFavoriteCount();
    loadFavorites();
    updateCartCount();
});
document.addEventListener('DOMContentLoaded', function () {
    const cartCount = localStorage.getItem('cartCount') || 0;
    document.querySelector('.fa-shopping-bag + span').textContent = cartCount;

    const favoriteCount = localStorage.getItem('favoriteCount') || 0;
    document.querySelector('.fa-heart + span').textContent = favoriteCount;

    updateCartCount();
    updateFavoriteCount();
});

function openNav(id) {
    document.getElementById(`mySidenav-${id}`).style.width = "400px";
    document.getElementById(`overlay-${id}`).style.display = "block";
    currentIndex[id] = 0;
    showSlides(id);
}


function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const totalCount = cart.reduce((total, item) => total + item.quantity, 0);
    document.querySelector('.fa-shopping-bag + span').textContent = totalCount;
    localStorage.setItem('cartCount', totalCount);
}

function closeNav(id) {
    document.getElementById(`mySidenav-${id}`).style.width = "0";
    document.getElementById(`overlay-${id}`).style.display = "none";
}


function changeQuantity1(amount, productId) {
    const quantityElement = document.getElementById(`quantity-${productId}`);
    if (quantityElement) {
        let quantity = parseInt(quantityElement.textContent);
        quantity = Math.max(1, quantity + amount);
        quantityElement.textContent = quantity;
        updatePrice(productId);
    }
}


function changeQuantity(amount, productId) {
    let quantityElement = document.getElementById(`quantity-${productId}`);
    if (quantityElement) {
        let oldValue = parseInt(quantityElement.value);
        let newValue = oldValue + amount;
        if (newValue < 1) {
            newValue = 1;
        }
        quantityElement.value = newValue;
        updatePrice(productId);
    }
}

let currentIndex = {};

function moveSlide(id, n) {
    currentIndex[id] += n;
    showSlides(id);
}

function showSlides(id) {
    const slides = document.querySelectorAll(`#slider-${id} .slides img`);
    if (currentIndex[id] >= slides.length) {
        currentIndex[id] = 0;
    }
    if (currentIndex[id] < 0) {
        currentIndex[id] = slides.length - 1;
    }
    slides.forEach((slide, index) => {
        slide.style.display = index === currentIndex[id] ? 'block' : 'none';
    });
}

function toggleFavorite(productId) {
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    if (favorites.includes(productId)) {
        favorites = favorites.filter(id => id !== productId);
    } else {
        favorites.push(productId);
    }
    localStorage.setItem('favorites', JSON.stringify(favorites));
    updateFavoriteCount();
    loadFavorites();
}

function updateFavoriteCount() {
    const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    document.getElementById('favorite-count').textContent = favorites.length;
}


function loadFavorites() {
    const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    const favoritesList = document.getElementById('favoritesList');
    favoritesList.innerHTML = '';

    favorites.forEach(id => {
        const product = products.find(p => p.id === id);
        if (product) {
            favoritesList.innerHTML += `
                <div class="favorite-item">
                    <h4>${product.name}</h4>
                    <p>${product.price}</p>
                    <p>${product.description}</p>
                    <button onclick="removeFavorite(${id})">Remove</button>
                </div>
            `;
        }
    });
}

function removeFavorite(productId) {
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    favorites = favorites.filter(id => id !== productId);
    localStorage.setItem('favorites', JSON.stringify(favorites));
    updateFavoriteCount();
    loadFavorites();
}

function showFavoritesPopup() {
    const popup = document.getElementById('favoritesPopup');
    popup.style.display = 'block';
    loadFavorites();
}

function closeFavoritesPopup() {
    const popup = document.getElementById('favoritesPopup');
    popup.style.display = 'none';
}